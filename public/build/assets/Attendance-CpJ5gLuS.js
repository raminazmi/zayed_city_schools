import{u as g,r as d,j as a,S as B,a as F,A as I}from"./app-DrYGkpmb.js";import{A as L}from"./AuthenticatedLayout-DH1WOUyn.js";import{B as R}from"./Breadcrumb-D-yvS0r1.js";import{D as W}from"./DataTable-DNMqza36.js";import{u as H,A as P,a as q}from"./useAttendance-1k6IQ-6x.js";import{M as z}from"./Modal-Ci7YKdA6.js";import{t as G}from"./index-CfQLVbGg.js";import{y as i,L as J}from"./index-C0CEYPt1.js";import{h as j}from"./moment-DSbgDjSZ.js";import"./ApplicationLogo-D0gAqrgm.js";import"./transition-pEnpc1Cw.js";import"./PrimaryButton-CHSvh-7U.js";function re({auth:v,classroom:l,students:h,classId:S,date:s}){const x=g(t=>t.theme.darkMode==="dark"),N=g(t=>t.language.current),e=G[N],_={Sunday:e.Sunday,Monday:e.Monday,Tuesday:e.Tuesday,Wednesday:e.Wednesday,Thursday:e.Thursday,Friday:e.Friday,Saturday:e.Saturday},p=j(s).format("YYYY-MM-DD"),f=_[j(s).format("dddd")],[A,n]=d.useState(!1),[c,y]=d.useState(null),[o,b]=d.useState(!1),{attendance:m,handleAttendanceChange:$,resetAttendance:w,fetchAttendance:k,pleaseFillAllAttendance:C}=H(h,`/admin/dashboard/attendance/${l.id}/view?date=${s}`);d.useEffect(()=>{k().catch(t=>{console.error("Error fetching attendance:",t),i.error("فشل في جلب بيانات الحضور.",{position:"top-right",autoClose:3e3})})},[]);const D=async()=>{if(!C()){y(e.please_fill_all_attendance),n(!0);return}y(null),n(!0)},M=async()=>{var t,r;try{if(b(!0),!s||isNaN(new Date(s))){i.error("التاريخ المقدم غير صالح!",{position:"top-right",autoClose:3e3});return}(await F.post(`/admin/dashboard/attendance/${l.id}/attendance`,{attendance:m,date:s})).data.message&&(n(!1),i.success("تم حفظ الحضور بنجاح!",{position:"top-right",autoClose:3e3})),I.visit(`/admin/dashboard/attendance/${S}/view?date=${s}`)}catch(u){console.error("Error saving attendance:",u),i.error(((r=(t=u.response)==null?void 0:t.data)==null?void 0:r.message)||"فشل في حفظ الحضور",{position:"top-right",autoClose:3e3})}finally{b(!1)}},T=[{key:"student_name",label:e.student_name,sortable:!1},{key:"attendance_status",label:e.attendance_status,render:(t,r)=>a.jsx(P,{studentId:r.id,currentStatus:m[r.id],onChange:$,translations:e})}],E=h.map(t=>({id:t.id,student_name:t.name,attendance_status:m[t.id]})),Y=[{label:e.attendance,href:"/admin/dashboard/attendance"},{label:l.name}];return a.jsxs(L,{user:v.user,children:[a.jsx(B,{title:`${f} (${p})`}),a.jsx("div",{className:"flex",style:{height:"calc(100vh - 66px)"},children:a.jsx("main",{className:"flex-1 overflow-y-auto",children:a.jsxs("div",{className:"py-6",children:[a.jsxs("div",{className:"mx-auto px-4 sm:px-6 md:px-14",children:[a.jsx(R,{items:Y}),a.jsx(q,{title:`${f} (${p})`,onReset:w,onSave:D,translations:e,isDark:x})]}),a.jsx("div",{className:"mx-auto px-4 sm:px-6 md:px-14 mt-6",children:a.jsx(W,{columns:T,data:E,selectable:!1,searchable:!1,filterable:!1,actions:!1})})]})})}),a.jsx(z,{show:A,onClose:()=>n(!1),children:a.jsxs("div",{className:"p-6",children:[a.jsx("h2",{className:`text-lg font-medium ${x?"text-TextLight":"text-TextDark"}`,children:c?e.error:e.confirm_save_attendance}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:c||e.confirm_save_attendance_message}),a.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[a.jsx("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:()=>n(!1),disabled:o,children:e.cancel}),!c&&a.jsx("button",{type:"button",className:`px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 ${o?"opacity-50 cursor-not-allowed":""}`,onClick:M,disabled:o,children:o?e.saving:e.save})]})]})}),a.jsx(J,{})]})}export{re as default};
