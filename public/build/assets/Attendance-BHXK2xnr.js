import{u as g,r as d,j as t,S as B,a as F,A as I}from"./app-DrYGkpmb.js";import{A as L}from"./AuthenticatedLayout-DH1WOUyn.js";import{B as R}from"./Breadcrumb-D-yvS0r1.js";import{D as W}from"./DataTable-DNMqza36.js";import{u as H,A as P,a as q}from"./useAttendance-1k6IQ-6x.js";import{M as z}from"./Modal-Ci7YKdA6.js";import{t as G}from"./index-CfQLVbGg.js";import{y as i,L as J}from"./index-C0CEYPt1.js";import{h as j}from"./moment-DSbgDjSZ.js";import"./ApplicationLogo-D0gAqrgm.js";import"./transition-pEnpc1Cw.js";import"./PrimaryButton-CHSvh-7U.js";function re({auth:v,classroom:l,students:h,classId:S,date:s}){const x=g(a=>a.theme.darkMode==="dark"),N=g(a=>a.language.current),e=G[N],[_,n]=d.useState(!1),[c,p]=d.useState(null),[o,f]=d.useState(!1),{attendance:m,handleAttendanceChange:A,resetAttendance:$,fetchAttendance:w,pleaseFillAllAttendance:k}=H(h,`/teacher/dashboard/attendance/${l.id}/view?date=${s}`),C={Sunday:e.Sunday,Monday:e.Monday,Tuesday:e.Tuesday,Wednesday:e.Wednesday,Thursday:e.Thursday,Friday:e.Friday,Saturday:e.Saturday},y=j(s).format("YYYY-MM-DD"),b=C[j(s).format("dddd")];d.useEffect(()=>{w().catch(a=>{console.error("Error fetching attendance:",a),i.error("فشل في جلب بيانات الحضور.",{position:"top-right",autoClose:3e3})})},[]);const D=async()=>{if(!k()){p(e.please_fill_all_attendance),n(!0);return}p(null),n(!0)},M=async()=>{var a,r;try{if(f(!0),!s||isNaN(new Date(s))){i.error("التاريخ المقدم غير صالح!",{position:"top-right",autoClose:3e3});return}(await F.post(`/teacher/dashboard/attendance/${l.id}/attendance`,{attendance:m,date:s})).data.message&&(n(!1),i.success("تم حفظ الحضور بنجاح!",{position:"top-right",autoClose:3e3})),I.visit(`/teacher/dashboard/attendance/${S}/view?date=${s}`)}catch(u){console.error("Error saving attendance:",u),i.error(((r=(a=u.response)==null?void 0:a.data)==null?void 0:r.message)||"فشل في حفظ الحضور",{position:"top-right",autoClose:3e3})}finally{f(!1)}},T=[{key:"student_name",label:e.student_name,sortable:!1},{key:"attendance_status",label:e.attendance_status,render:(a,r)=>t.jsx(P,{studentId:r.id,currentStatus:m[r.id],onChange:A,translations:e})}],E=h.map(a=>({id:a.id,student_name:a.name,attendance_status:m[a.id]})),Y=[{label:e.attendance,href:"/teacher/dashboard/attendance"},{label:l.name}];return t.jsxs(L,{user:v.user,children:[t.jsx(B,{title:`${b} (${y})`}),t.jsx("div",{className:"flex",style:{height:"calc(100vh - 66px)"},children:t.jsx("main",{className:"flex-1 overflow-y-auto",children:t.jsxs("div",{className:"py-6",children:[t.jsxs("div",{className:"mx-auto px-4 sm:px-6 md:px-14",children:[t.jsx(R,{items:Y}),t.jsx(q,{title:`${b} (${y})`,onReset:$,onSave:D,translations:e,isDark:x})]}),t.jsx("div",{className:"mx-auto px-4 sm:px-6 md:px-14 mt-6",children:t.jsx(W,{columns:T,data:E,selectable:!1,searchable:!1,filterable:!1,actions:!1})})]})})}),t.jsx(z,{show:_,onClose:()=>n(!1),children:t.jsxs("div",{className:"p-6",children:[t.jsx("h2",{className:`text-lg font-medium ${x?"text-TextLight":"text-TextDark"}`,children:c?e.error:e.confirm_save_attendance}),t.jsx("p",{className:"mt-2 text-sm text-gray-500",children:c||e.confirm_save_attendance_message}),t.jsxs("div",{className:"mt-6 flex justify-end gap-3",children:[t.jsx("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",onClick:()=>n(!1),disabled:o,children:e.cancel}),!c&&t.jsx("button",{type:"button",className:`px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 ${o?"opacity-50 cursor-not-allowed":""}`,onClick:M,disabled:o,children:o?e.saving:e.save})]})]})}),t.jsx(J,{})]})}export{re as default};
